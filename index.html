<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Contador de votos presidenciales 2025</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
      max-width: 600px;
      margin: auto;
    }
    h1 {
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
    }
    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin: 1rem 0;
    }
    button {
      padding: 0.7rem 1rem;
      font-size: 1rem;
      flex: 1 1 45%;
      min-width: 100px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.4rem;
      text-align: left;
    }
    .total {
      margin-top: 1rem;
      font-weight: bold;
      font-size: 1.1rem;
    }
    .undo {
      background-color: #ff6666;
      color: white;
      width: 100%;
      margin-top: 0.5rem;
      padding: 0.7rem;
      border: none;
    }
    .reset {
      background-color: #444;
      color: white;
      width: 100%;
      margin-top: 0.5rem;
      padding: 0.7rem;
      border: none;
    }
  </style>
</head>
<body>

  <h1>Contador de votos presidenciales 2025</h1>

  <p>
    Toque un botón para sumar un voto.<br>
    <b>Antes de empezar el conteo real</b>, asegúrese de presionar
    <i>“Reiniciar conteo”</i> para dejar todo en cero.
  </p>

  <div class="buttons">
    <button onclick="addVote('kaiser')">Kaiser</button>
    <button onclick="addVote('kast')">Kast</button>
    <button onclick="addVote('matthei')">Matthei</button>
    <button onclick="addVote('parisi')">Parisi</button>
    <button onclick="addVote('mayne')">Mayne-Nicholls</button>
    <button onclick="addVote('meo')">MEO</button>
    <button onclick="addVote('jara')">Jara</button>
    <button onclick="addVote('artes')">Artes</button>
    <button onclick="addVote('nulo')">Nulo</button>
    <button onclick="addVote('blanco')">Blanco</button>
  </div>

  <button class="undo" onclick="undoLast()">Deshacer último voto</button>
  <button class="reset" onclick="resetAll()">Reiniciar conteo</button>

  <table>
    <thead>
      <tr>
        <th>Candidato</th>
        <th>Votos</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>Kaiser</td><td id="kaiser_vt">0</td></tr>
      <tr><td>Kast</td><td id="kast_vt">0</td></tr>
      <tr><td>Matthei</td><td id="matthei_vt">0</td></tr>
      <tr><td>Parisi</td><td id="parisi_vt">0</td></tr>
      <tr><td>Mayne-Nicholls</td><td id="mayne_vt">0</td></tr>
      <tr><td>MEO</td><td id="meo_vt">0</td></tr>
      <tr><td>Jara</td><td id="jara_vt">0</td></tr>
      <tr><td>Artes</td><td id="artes_vt">0</td></tr>
      <tr><td>Nulo</td><td id="nulo_vt">0</td></tr>
      <tr><td>Blanco</td><td id="blanco_vt">0</td></tr>
    </tbody>
  </table>

  <div class="total">
    Total: <span id="total_vt">0</span>
  </div>

  <script>
    const STORAGE_KEY = "contador_votos_2025";

    const votes = {
      kaiser: 0,
      kast: 0,
      matthei: 0,
      parisi: 0,
      mayne: 0,
      meo: 0,
      jara: 0,
      artes: 0,
      nulo: 0,
      blanco: 0
    };

    const history = [];

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;

        const data = JSON.parse(raw);

        if (data.votes) {
          for (const key in votes) {
            if (Object.prototype.hasOwnProperty.call(data.votes, key)) {
              votes[key] = data.votes[key];
            }
          }
        }

        if (Array.isArray(data.history)) {
          history.splice(0, history.length, ...data.history);
        }
      } catch (e) {
        console.warn("No se pudo cargar el estado guardado:", e);
      }
    }

    function saveState() {
      const data = {
        votes: votes,
        history: history
      };
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      } catch (e) {
        console.warn("No se pudo guardar el estado:", e);
      }
    }

    function updateDisplay() {
      let total = 0;

      for (const key in votes) {
        total += votes[key];
        const cell = document.getElementById(key + "_vt");
        if (cell) {
          cell.textContent = votes[key];
        }
      }

      document.getElementById("total_vt").textContent = total;
    }

    function addVote(key) {
      if (!(key in votes)) {
        alert("Candidato desconocido: " + key);
        return;
      }
      votes[key] += 1;
      history.push(key);
      updateDisplay();
      saveState();
    }

    function undoLast() {
      if (history.length === 0) {
        alert("No hay votos para deshacer.");
        return;
      }

      const last = history.pop();
      votes[last] -= 1;
      updateDisplay();
      saveState();
    }

    function resetAll() {
      const ok = confirm(
        "¿Seguro que quieres reiniciar todos los votos?\n" +
        "Esta acción no se puede deshacer."
      );
      if (!ok) return;

      // Poner todos los votos en 0
      for (const key in votes) {
        votes[key] = 0;
      }

      // Vaciar historial
      history.splice(0, history.length);

      updateDisplay();
      saveState();
    }

    // Al cargar la página:
    loadState();
    updateDisplay();
  </script>

</body>
</html>